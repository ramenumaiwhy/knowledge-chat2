# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Commands

### Development
```bash
npm run merge-csv    # Merge updates to main knowledge base
node scripts/csv-merger.js    # Manual CSV merge operation
./scripts/generate-secrets.sh    # Generate security keys for deployment
```

### Testing
```bash
# Test n8n workflow locally
curl -X POST http://localhost:5678/webhook/line -H "Content-Type: application/json" -d '{"message":"test"}'
```

## Architecture Overview

This is a **KnowledgeLink** chatbot system with the following components:

### Core System
- **n8n Workflow Engine**: Handles LINE webhook processing, CSV data retrieval, and AI integration
- **GitHub CSV Storage**: Version-controlled knowledge base using CSV files in the repository
- **Google Gemini API**: Natural language processing and response generation
- **Railway Deployment**: Docker container hosting with environment variable management

### Data Flow
```
LINE User → LINE API → n8n (Railway) → GitHub CSV → Gemini API → Response
```

### Key Files
- `n8n-workflow.json`: Complete workflow definition for n8n import
- `data/knowledge.csv`: Main knowledge database
- `data/updates.csv`: Staging area for new knowledge entries
- `scripts/csv-merger.js`: Automated CSV merging utility
- `Dockerfile`: n8n container with Python tools for CSV processing
- `docs/`: All documentation and implementation guides
- `temp/`: Temporary files and testing artifacts

### Environment Variables (Railway)
- `LINE_CHANNEL_ACCESS_TOKEN`, `LINE_CHANNEL_SECRET`: LINE API credentials
- `GEMINI_API_KEY`: Google AI API access
- `GITHUB_TOKEN`, `GITHUB_OWNER`, `GITHUB_REPO`: GitHub API access for CSV files
- `N8N_BASIC_AUTH_PASSWORD`, `N8N_ENCRYPTION_KEY`: n8n security

### CSV Schema
```csv
id,category,question,answer,keywords,source,updated_at
```

## Development Notes

- Knowledge updates are staged in `updates.csv` then merged to `knowledge.csv`
- n8n workflow uses JavaScript for CSV parsing and keyword matching
- Responses are generated by Gemini API with context from matched CSV entries
- All documentation is in Japanese for end-user guides
- Current cost: $5/month (Railway hosting only)

## Deployment

The system runs on Railway using Docker container deployment. The n8n workflow is imported via the JSON file and configured with environment variables for all external service connections.