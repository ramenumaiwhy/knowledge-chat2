{
  "name": "LINE Chatbot Ultimate with AI",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "line-webhook",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "webhook",
      "name": "LINE Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [250, 300],
      "webhookId": "line-webhook"
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json.body.events[0].message.text }}",
              "operation": "regex",
              "value2": "(ã“ã‚“ã«ã¡ã¯|ã“ã‚“ã°ã‚“ã¯|ãŠã¯ã‚ˆã†|ã¯ã˜ã‚ã¾ã—ã¦|ã‚ˆã‚ã—ã|ã¡ã‚|ã‚„ã‚)"
            }
          ]
        }
      },
      "id": "greetingCheck",
      "name": "æŒ¨æ‹¶ãƒã‚§ãƒƒã‚¯",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [450, 300]
    },
    {
      "parameters": {
        "jsCode": "// æŒ¨æ‹¶å°‚ç”¨ã®è¿”ç­”ã‚’ç”Ÿæˆ\nconst greetings = [\n  'ãƒãƒã§ã™ï¼ä»Šæ—¥ã‚‚å…ƒæ°—ã«ã‚¬ãƒ³ã‚¬ãƒ³ã„ãã¾ã—ã‚‡ã†ï¼',\n  'ãŠã£ã™ï¼ãƒãƒã§ã™ã€‚ä½•ã‹èããŸã„ã“ã¨ã‚ã£ãŸã‚‰ãƒ‰ãƒ³ãƒ‰ãƒ³èã„ã¦ãã ã•ã„ï¼',\n  'ãƒãƒã§ã™ã€‚ã‚ˆã‚ã—ãï¼ãƒŠãƒ³ãƒ‘ã®ã“ã¨ãªã‚‰ä»»ã›ã¦ãã ã•ã„ï¼'\n];\n\nconst randomGreeting = greetings[Math.floor(Math.random() * greetings.length)];\n\nreturn {\n  replyToken: $input.first().json.body.events[0].replyToken,\n  message: randomGreeting,\n  isGreeting: true\n};"
      },
      "id": "greetingResponse",
      "name": "æŒ¨æ‹¶è¿”ç­”ç”Ÿæˆ",
      "type": "n8n-nodes-base.code",
      "typeVersion": 1,
      "position": [650, 200]
    },
    {
      "parameters": {
        "jsCode": "// ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¿ã‚¤ãƒ—ã‚’åˆ†æ\nconst message = $json.body.events[0].message.text;\nconst replyToken = $json.body.events[0].replyToken;\n\n// ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é•·ã«ã‚ˆã‚‹åˆ†é¡\nconst messageLength = message.length;\nlet queryType = 'general';\n\nif (messageLength <= 5) {\n  queryType = 'keyword';\n} else if (message.includes('ï¼Ÿ') || message.includes('?')) {\n  queryType = 'question';\n} else if (message.includes('æ•™ãˆã¦') || message.includes('çŸ¥ã‚ŠãŸã„')) {\n  queryType = 'consultation';\n}\n\n// ç·Šæ€¥åº¦ãƒã‚§ãƒƒã‚¯\nconst urgentKeywords = ['ä»Šã™ã', 'ã™ãã«', 'ç·Šæ€¥', 'æ€¥ã„ã§'];\nconst isUrgent = urgentKeywords.some(keyword => message.includes(keyword));\n\n// å ´æ‰€ã®æ¤œå‡º\nconst locations = ['æ¸‹è°·', 'æ–°å®¿', 'æµæ¯”å¯¿', 'å…­æœ¬æœ¨', 'æ± è¢‹', 'éŠ€åº§'];\nconst detectedLocation = locations.find(loc => message.includes(loc));\n\nreturn {\n  originalMessage: message,\n  replyToken,\n  queryType,\n  isUrgent,\n  location: detectedLocation || null,\n  timestamp: new Date().toISOString()\n};"
      },
      "id": "messageAnalyzer",
      "name": "ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸åˆ†æ",
      "type": "n8n-nodes-base.code",
      "typeVersion": 1,
      "position": [450, 400]
    },
    {
      "parameters": {
        "jsCode": "// é¡ç¾©èªå±•é–‹ã¨ã‚¯ã‚¨ãƒªæ‹¡å¼µ\nconst SYNONYMS = {\n  'ãƒŠãƒ³ãƒ‘': ['å£°ã‹ã‘', 'ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ', 'ã‚¹ãƒˆãƒªãƒ¼ãƒˆãƒŠãƒ³ãƒ‘', 'ã‚¹ãƒˆãƒŠãƒ³', 'å£°æ›ã‘'],\n  'å¥³æ€§': ['å¥³', 'å¥³ã®å­', 'å¥³å­', 'ã‚¬ãƒ¼ãƒ«', 'ãƒ¬ãƒ‡ã‚£', 'å¥³ã®äºº'],\n  'ãƒ‡ãƒ¼ãƒˆ': ['ã‚¢ãƒ', 'ã‚¢ãƒã‚¤ãƒ³ãƒˆ', 'ç´„æŸ', 'ãŠèŒ¶', 'é£²ã¿', 'é£Ÿäº‹'],\n  'ã‚³ãƒ„': ['æ–¹æ³•', 'ã‚„ã‚Šæ–¹', 'ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯', 'ç§˜è¨£', 'ãƒã‚¤ãƒ³ãƒˆ', 'ãƒã‚¦ãƒã‚¦'],\n  'LINE': ['ãƒ©ã‚¤ãƒ³', 'é€£çµ¡å…ˆ', 'ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸', 'ãƒˆãƒ¼ã‚¯'],\n  'æˆåŠŸ': ['ã†ã¾ãã„ã', 'æˆåŠŸ', 'ã‚²ãƒƒãƒˆ', 'æˆæœ', 'çµæœ'],\n  'å¤±æ•—': ['ã†ã¾ãã„ã‹ãªã„', 'å¤±æ•—', 'ãƒŸã‚¹', 'ãƒ€ãƒ¡', 'æ–­ã‚‰ã‚Œ'],\n  'åˆå¿ƒè€…': ['åˆå¿ƒè€…', 'ãƒ“ã‚®ãƒŠãƒ¼', 'åˆã‚ã¦', 'æ–°äºº', 'ç´ äºº']\n};\n\n// ã‚¯ã‚¨ãƒªã‚’å±•é–‹\nfunction expandQuery(text) {\n  let expanded = [text];\n  \n  for (const [key, synonyms] of Object.entries(SYNONYMS)) {\n    if (text.includes(key)) {\n      synonyms.forEach(syn => {\n        expanded.push(text.replace(key, syn));\n      });\n    }\n  }\n  \n  // é‡è¤‡ã‚’å‰Šé™¤\n  return [...new Set(expanded)];\n}\n\nconst expandedQueries = expandQuery($json.originalMessage);\n\n// ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æŠ½å‡ºï¼ˆé‡è¦ãªå˜èªã‚’æŠ½å‡ºï¼‰\nconst keywords = [];\nfor (const [key, synonyms] of Object.entries(SYNONYMS)) {\n  if ($json.originalMessage.includes(key)) {\n    keywords.push(key);\n  }\n  synonyms.forEach(syn => {\n    if ($json.originalMessage.includes(syn)) {\n      keywords.push(key); // å…ƒã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã«çµ±ä¸€\n    }\n  });\n}\n\nreturn {\n  ...$json,\n  expandedQueries,\n  extractedKeywords: [...new Set(keywords)],\n  searchStrategies: ['exact', 'and', 'or', 'fuzzy']\n};"
      },
      "id": "queryExpander",
      "name": "ã‚¯ã‚¨ãƒªæ‹¡å¼µ",
      "type": "n8n-nodes-base.code",
      "typeVersion": 1,
      "position": [650, 400]
    },
    {
      "parameters": {
        "method": "GET",
        "url": "=https://api.github.com/repos/{{ $env.GITHUB_OWNER }}/{{ $env.GITHUB_REPO }}/contents/data/knowledge.csv",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "=token {{ $env.GITHUB_TOKEN }}"
            },
            {
              "name": "Accept",
              "value": "application/vnd.github.v3+json"
            }
          ]
        },
        "options": {}
      },
      "id": "getCSV",
      "name": "CSVå–å¾—",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 3,
      "position": [850, 400]
    },
    {
      "parameters": {
        "jsCode": "// é«˜åº¦ãªæ¤œç´¢ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ \nconst csvContent = $('CSVå–å¾—').first().json.content;\nconst csvData = Buffer.from(csvContent, 'base64').toString('utf-8');\n\n// CSVãƒ‘ãƒ¼ã‚¹\nfunction parseCSV(csv) {\n  const lines = csv.split('\\n');\n  const headers = lines[0].split(',').map(h => h.trim());\n  const data = [];\n  \n  for (let i = 1; i < lines.length; i++) {\n    if (!lines[i].trim()) continue;\n    \n    const values = [];\n    let current = '';\n    let inQuotes = false;\n    \n    for (let j = 0; j < lines[i].length; j++) {\n      const char = lines[i][j];\n      if (char === '\"') {\n        inQuotes = !inQuotes;\n      } else if (char === ',' && !inQuotes) {\n        values.push(current.trim());\n        current = '';\n      } else {\n        current += char;\n      }\n    }\n    values.push(current.trim());\n    \n    const row = {};\n    headers.forEach((header, index) => {\n      row[header] = values[index] || '';\n    });\n    data.push(row);\n  }\n  return data;\n}\n\nconst data = parseCSV(csvData);\nconst queryData = $('ã‚¯ã‚¨ãƒªæ‹¡å¼µ').first().json;\nconst results = [];\n\n// ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°é–¢æ•°\nfunction calculateScore(row, query, strategy) {\n  let score = 0;\n  const lowerQuery = query.toLowerCase();\n  \n  // ã‚«ãƒ†ã‚´ãƒªãƒãƒƒãƒï¼ˆ20ç‚¹ï¼‰\n  if (row.category && row.category.toLowerCase().includes(lowerQuery)) {\n    score += 20;\n  }\n  \n  // è³ªå•ãƒãƒƒãƒï¼ˆ15ç‚¹ï¼‰\n  if (row.question && row.question.toLowerCase().includes(lowerQuery)) {\n    score += 15;\n  }\n  \n  // ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒãƒï¼ˆ10ç‚¹ï¼‰\n  if (row.keywords) {\n    try {\n      const keywords = JSON.parse(row.keywords);\n      if (keywords.some(k => k.toLowerCase().includes(lowerQuery))) {\n        score += 10;\n      }\n    } catch (e) {\n      if (row.keywords.toLowerCase().includes(lowerQuery)) {\n        score += 10;\n      }\n    }\n  }\n  \n  // å›ç­”ãƒãƒƒãƒï¼ˆ5ç‚¹ï¼‰\n  if (row.answer && row.answer.toLowerCase().includes(lowerQuery)) {\n    score += 5;\n  }\n  \n  // æˆ¦ç•¥ãƒœãƒ¼ãƒŠã‚¹\n  if (strategy === 'exact' && score > 0) score *= 2;\n  if (strategy === 'fuzzy') score *= 0.7;\n  \n  // å ´æ‰€ãƒœãƒ¼ãƒŠã‚¹\n  if (queryData.location && row.answer && row.answer.includes(queryData.location)) {\n    score += 10;\n  }\n  \n  // ç·Šæ€¥åº¦ãƒœãƒ¼ãƒŠã‚¹\n  if (queryData.isUrgent) {\n    score *= 1.5;\n  }\n  \n  return Math.round(score);\n}\n\n// å„æˆ¦ç•¥ã§æ¤œç´¢\nqueryData.expandedQueries.forEach(query => {\n  data.forEach(row => {\n    const score = calculateScore(row, query, 'mixed');\n    if (score > 0) {\n      results.push({\n        ...row,\n        score,\n        matchedQuery: query,\n        strategy: 'mixed'\n      });\n    }\n  });\n});\n\n// é‡è¤‡å‰Šé™¤ã¨ã‚½ãƒ¼ãƒˆ\nconst uniqueResults = [];\nconst seen = new Set();\n\nresults\n  .sort((a, b) => b.score - a.score)\n  .forEach(result => {\n    const key = result.id || result.question;\n    if (!seen.has(key)) {\n      seen.add(key);\n      uniqueResults.push(result);\n    }\n  });\n\n// ä¸Šä½10ä»¶ã‚’è¿”ã™\nreturn {\n  ...queryData,\n  searchResults: uniqueResults.slice(0, 10),\n  totalFound: uniqueResults.length,\n  hasResults: uniqueResults.length > 0\n};"
      },
      "id": "advancedSearch",
      "name": "é«˜åº¦ãªæ¤œç´¢",
      "type": "n8n-nodes-base.code",
      "typeVersion": 1,
      "position": [1050, 400]
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "id": "no-results",
                    "leftValue": "={{ $json.hasResults }}",
                    "rightValue": false,
                    "operator": {
                      "type": "boolean",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "outputKey": "noResults"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "id": "low-score",
                    "leftValue": "={{ $json.searchResults[0].score }}",
                    "rightValue": 10,
                    "operator": {
                      "type": "number",
                      "operation": "lt"
                    }
                  }
                ],
                "combinator": "and"
              },
              "outputKey": "lowConfidence"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "id": "high-score",
                    "leftValue": "={{ $json.searchResults[0].score }}",
                    "rightValue": 30,
                    "operator": {
                      "type": "number",
                      "operation": "gte"
                    }
                  }
                ],
                "combinator": "and"
              },
              "outputKey": "highConfidence"
            }
          ]
        },
        "options": {
          "fallbackOutput": "fixed",
          "fallbackOutputFixed": "mediumConfidence"
        }
      },
      "id": "confidenceRouter",
      "name": "ä¿¡é ¼åº¦ãƒ«ãƒ¼ã‚¿ãƒ¼",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [1250, 400]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent",
        "authentication": "none",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "key",
              "value": "={{ $env.GEMINI_API_KEY }}"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"contents\": [{\n    \"parts\": [{\n      \"text\": \"ã‚ãªãŸã¯ãƒãƒã¨ã„ã†åå‰ã®æ‹æ„›ã‚³ãƒ³ã‚µãƒ«ã‚¿ãƒ³ãƒˆã§ã™ã€‚ä»¥ä¸‹ã®ç‰¹å¾´ã‚’æŒã£ã¦å›ç­”ã—ã¦ãã ã•ã„ï¼š\\n\\nã€æ€§æ ¼ã€‘\\n- è¦ªã—ã¿ã‚„ã™ãã€ã‚¨ãƒãƒ«ã‚®ãƒƒã‚·ãƒ¥\\n- å…·ä½“çš„ã§å®Ÿè·µçš„ãªã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’ã™ã‚‹\\n- å¤±æ•—ã‚’æã‚Œãªã„å‰å‘ããªå§¿å‹¢\\n\\nã€è©±ã—æ–¹ã€‘\\n- ã€ã‚¬ãƒ³ã‚¬ãƒ³ã€ã€ãƒ‰ãƒ³ãƒ‰ãƒ³ã€ãªã©ã®æ“¬éŸ³èªã‚’ä½¿ã†\\n- çŸ­ã„æ–‡ç« ã§æ­¯åˆ‡ã‚Œã‚ˆã\\n- æ™‚ã€…ã€ãªãœã‹ï¼Ÿã€ã¨è‡ªå•è‡ªç­”ã™ã‚‹\\n\\nãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è³ªå•: {{ $json.originalMessage }}\\n\\nå‚è€ƒæƒ…å ±ï¼ˆä¿¡é ¼åº¦: é«˜ï¼‰ï¼š\\n{{ $json.searchResults.slice(0, 3).map(r => `- ${r.question}: ${r.answer} (ã‚¹ã‚³ã‚¢: ${r.score})`).join('\\\\n') }}\\n\\nå…·ä½“çš„ã§å®Ÿè·µçš„ãªã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’200æ–‡å­—ç¨‹åº¦ã§ãŠé¡˜ã„ã—ã¾ã™ã€‚\"\n    }]\n  }]\n}",
        "options": {}
      },
      "id": "geminiHighConfidence",
      "name": "Gemini API (é«˜ä¿¡é ¼åº¦)",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 3,
      "position": [1450, 300]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent",
        "authentication": "none",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "key",
              "value": "={{ $env.GEMINI_API_KEY }}"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"contents\": [{\n    \"parts\": [{\n      \"text\": \"ã‚ãªãŸã¯ãƒãƒã¨ã„ã†æ‹æ„›ã‚³ãƒ³ã‚µãƒ«ã‚¿ãƒ³ãƒˆã§ã™ã€‚\\n\\nãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è³ªå•: {{ $json.originalMessage }}\\n\\nå‚è€ƒæƒ…å ±ï¼ˆä¿¡é ¼åº¦: ä¸­ï¼‰ï¼š\\n{{ $json.searchResults.slice(0, 2).map(r => `- ${r.answer?.substring(0, 100)}... (é–¢é€£åº¦: ${r.score})`).join('\\\\n') }}\\n\\næƒ…å ±ãŒé™å®šçš„ã§ã™ãŒã€ä¸€èˆ¬çš„ãªã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’å«ã‚ã¦å›ç­”ã—ã¦ãã ã•ã„ã€‚ã€å‚è€ƒæƒ…å ±ãŒå°‘ãªã„ã§ã™ãŒã€ã¨ã„ã†å‰ç½®ãã‚’ã—ã¦ã€150æ–‡å­—ç¨‹åº¦ã§å›ç­”ã—ã¦ãã ã•ã„ã€‚\"\n    }]\n  }]\n}",
        "options": {}
      },
      "id": "geminiMediumConfidence",
      "name": "Gemini API (ä¸­ä¿¡é ¼åº¦)",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 3,
      "position": [1450, 400]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent",
        "authentication": "none",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "key",
              "value": "={{ $env.GEMINI_API_KEY }}"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"contents\": [{\n    \"parts\": [{\n      \"text\": \"ã‚ãªãŸã¯ãƒãƒã¨ã„ã†æ‹æ„›ã‚³ãƒ³ã‚µãƒ«ã‚¿ãƒ³ãƒˆã§ã™ã€‚\\n\\nãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è³ªå•: {{ $json.originalMessage }}\\n\\nç”³ã—è¨³ã”ã–ã„ã¾ã›ã‚“ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰ç›´æ¥çš„ãªæƒ…å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚\\n\\nã—ã‹ã—ã€ä¸€èˆ¬çš„ãªã‚¢ãƒ‰ãƒã‚¤ã‚¹ã¨ã—ã¦å›ç­”ã—ã¾ã™ã€‚ãƒãƒã‚‰ã—ãå…ƒæ°—ã«ã€100æ–‡å­—ç¨‹åº¦ã§å›ç­”ã—ã¦ãã ã•ã„ã€‚æœ€å¾Œã«ã€è©³ã—ãã¯å€‹åˆ¥ç›¸è«‡ã§ï¼ã€ã¨ä»˜ã‘åŠ ãˆã¦ãã ã•ã„ã€‚\"\n    }]\n  }]\n}",
        "options": {}
      },
      "id": "geminiNoResults",
      "name": "Gemini API (çµæœãªã—)",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 3,
      "position": [1450, 500]
    },
    {
      "parameters": {
        "operation": "inject",
        "textField": "={{ $json.candidates[0].content.parts[0].text }}",
        "styleIntensity": 0.8,
        "queryType": "={{ $('ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸åˆ†æ').item.json.queryType }}"
      },
      "id": "chibaStyle",
      "name": "ãƒãƒã‚¹ã‚¿ã‚¤ãƒ«æ³¨å…¥",
      "type": "ChibaStyle",
      "typeVersion": 1,
      "position": [1650, 400]
    },
    {
      "parameters": {
        "keepOnlySet": true,
        "values": {
          "string": [
            {
              "name": "finalMessage",
              "value": "={{ $json.styledText || $json.candidates[0].content.parts[0].text }}"
            },
            {
              "name": "replyToken",
              "value": "={{ $('ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸åˆ†æ').item.json.replyToken }}"
            }
          ],
          "number": [
            {
              "name": "confidence",
              "value": "={{ $('é«˜åº¦ãªæ¤œç´¢').item.json.searchResults[0]?.score || 0 }}"
            }
          ],
          "boolean": [
            {
              "name": "hasChivaStyle",
              "value": "={{ $json.validation?.isAuthentic || false }}"
            }
          ]
        },
        "options": {}
      },
      "id": "dataAggregator",
      "name": "ãƒ‡ãƒ¼ã‚¿é›†ç´„",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3,
      "position": [1850, 400]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.line.me/v2/bot/message/reply",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "Authorization",
              "value": "=Bearer {{ $env.LINE_CHANNEL_ACCESS_TOKEN }}"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"replyToken\": \"{{ $json.replyToken }}\",\n  \"messages\": [\n    {\n      \"type\": \"text\",\n      \"text\": \"{{ $json.finalMessage }}\"\n    }\n  ]\n}",
        "options": {
          "response": {
            "response": {
              "neverError": true
            }
          }
        }
      },
      "id": "lineReply",
      "name": "LINEè¿”ä¿¡",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 3,
      "position": [2050, 400]
    },
    {
      "parameters": {
        "respondWith": "noData"
      },
      "id": "webhookResponse",
      "name": "Webhook Response",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [2250, 400]
    },
    {
      "parameters": {
        "level": "warning",
        "message": "=æ¤œç´¢ã‚¨ãƒ©ãƒ¼: {{ $json.error.message }}",
        "additionalFields": {
          "metadata": "={{ { query: $('ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸åˆ†æ').item.json.originalMessage, timestamp: new Date().toISOString() } }}"
        }
      },
      "id": "errorLogger",
      "name": "ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°",
      "type": "n8n-nodes-base.n8n",
      "typeVersion": 1,
      "position": [1050, 600]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://discord.com/api/webhooks/{{ $env.DISCORD_WEBHOOK_URL }}",
        "authentication": "none",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"content\": \"ğŸ”” æ–°ã—ã„è³ªå•\\n**ãƒ¦ãƒ¼ã‚¶ãƒ¼**: {{ $('ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸åˆ†æ').item.json.originalMessage }}\\n**å›ç­”ä¿¡é ¼åº¦**: {{ $json.confidence }}\\n**ã‚¿ã‚¤ãƒ—**: {{ $('ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸åˆ†æ').item.json.queryType }}\\n**å ´æ‰€**: {{ $('ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸åˆ†æ').item.json.location || 'ãªã—' }}\"\n}",
        "options": {
          "response": {
            "response": {
              "neverError": true
            }
          }
        }
      },
      "id": "discordNotify",
      "name": "Discordé€šçŸ¥ (ã‚ªãƒ—ã‚·ãƒ§ãƒ³)",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 3,
      "position": [2050, 500]
    }
  ],
  "connections": {
    "LINE Webhook": {
      "main": [
        [
          {
            "node": "æŒ¨æ‹¶ãƒã‚§ãƒƒã‚¯",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "æŒ¨æ‹¶ãƒã‚§ãƒƒã‚¯": {
      "main": [
        [
          {
            "node": "æŒ¨æ‹¶è¿”ç­”ç”Ÿæˆ",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸åˆ†æ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸åˆ†æ": {
      "main": [
        [
          {
            "node": "ã‚¯ã‚¨ãƒªæ‹¡å¼µ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ã‚¯ã‚¨ãƒªæ‹¡å¼µ": {
      "main": [
        [
          {
            "node": "CSVå–å¾—",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "CSVå–å¾—": {
      "main": [
        [
          {
            "node": "é«˜åº¦ãªæ¤œç´¢",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "é«˜åº¦ãªæ¤œç´¢": {
      "main": [
        [
          {
            "node": "ä¿¡é ¼åº¦ãƒ«ãƒ¼ã‚¿ãƒ¼",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ä¿¡é ¼åº¦ãƒ«ãƒ¼ã‚¿ãƒ¼": {
      "main": [
        [
          {
            "node": "Gemini API (çµæœãªã—)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Gemini API (ä¸­ä¿¡é ¼åº¦)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Gemini API (ä¸­ä¿¡é ¼åº¦)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Gemini API (é«˜ä¿¡é ¼åº¦)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Gemini API (é«˜ä¿¡é ¼åº¦)": {
      "main": [
        [
          {
            "node": "ãƒãƒã‚¹ã‚¿ã‚¤ãƒ«æ³¨å…¥",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Gemini API (ä¸­ä¿¡é ¼åº¦)": {
      "main": [
        [
          {
            "node": "ãƒãƒã‚¹ã‚¿ã‚¤ãƒ«æ³¨å…¥",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Gemini API (çµæœãªã—)": {
      "main": [
        [
          {
            "node": "ãƒãƒã‚¹ã‚¿ã‚¤ãƒ«æ³¨å…¥",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ãƒãƒã‚¹ã‚¿ã‚¤ãƒ«æ³¨å…¥": {
      "main": [
        [
          {
            "node": "ãƒ‡ãƒ¼ã‚¿é›†ç´„",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ãƒ‡ãƒ¼ã‚¿é›†ç´„": {
      "main": [
        [
          {
            "node": "LINEè¿”ä¿¡",
            "type": "main",
            "index": 0
          },
          {
            "node": "Discordé€šçŸ¥ (ã‚ªãƒ—ã‚·ãƒ§ãƒ³)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "LINEè¿”ä¿¡": {
      "main": [
        [
          {
            "node": "Webhook Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "æŒ¨æ‹¶è¿”ç­”ç”Ÿæˆ": {
      "main": [
        [
          {
            "node": "LINEè¿”ä¿¡",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°": {
      "main": [
        [
          {
            "node": "Gemini API (çµæœãªã—)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {},
  "id": "ultimate-workflow"
}